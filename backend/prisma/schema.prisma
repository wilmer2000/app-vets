generator client {
  provider        = "prisma-client"
  output          = "./generated/prisma"
  previewFeatures = ["strictUndefinedChecks"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String?
  name      String?
  lastname  String?
  phone     String?
  address   Address? @relation(fields: [addressId], references: [id])
  addressId String?
  role      Role     @default(USER)
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  vetProfile   VetProfile?
  ownerProfile OwnerProfile?
}

model VetProfile {
  id        String     @id @default(uuid())
  specialty Specialty?

  user              User          @relation(fields: [userId], references: [id])
  userId            String        @unique
  staffAtVeterinary Veterinary[]  @relation("VeterinaryStaff")
  appointments      Appointment[]
}

model OwnerProfile {
  id   String @id @default(uuid())
  pets Pet[]

  user         User          @relation(fields: [userId], references: [id])
  userId       String        @unique
  appointments Appointment[]
  veterinary   Veterinary?   @relation("AffilationAt", fields: [veterinaryId], references: [id])
  veterinaryId String?
}

model Address {
  id      String @id @default(uuid())
  street  String
  city    String
  country String

  users User[]
}

model Pet {
  id        String   @id @default(uuid())
  name      String
  breed     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner         OwnerProfile @relation(fields: [ownerId], references: [id])
  ownerId       String
  veterinary    Veterinary   @relation(fields: [veterinaryId], references: [id])
  veterinaryId  String
  appointment   Appointment? @relation(fields: [appointmentId], references: [id])
  appointmentId String?
}

model Veterinary {
  id            String   @id @default(uuid())
  name          String
  description   String
  email         String
  phone         String
  street        String
  city          String
  country       String
  businessHours String
  isActive      Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  configuration Configuration?
  services      Service[]
  payments      Payment[]
  owners        OwnerProfile[] @relation("AffilationAt")
  staff         VetProfile[]   @relation("VeterinaryStaff")
  pets          Pet[]
  appointments  Appointment[]
}

model Configuration {
  id       String  @id @default(uuid())
  isActive Boolean @default(false)
  logo     String?
  color1   String?
  color2   String?

  veterinary   Veterinary @relation(fields: [veterinaryId], references: [id])
  veterinaryId String     @unique
}

model Service {
  id       String      @id @default(uuid())
  isActive Boolean     @default(false)
  type     TypeService
  name     String
  price    Float

  veterinary   Veterinary? @relation(fields: [veterinaryId], references: [id])
  veterinaryId String?
}

model Payment {
  id       String      @id @default(uuid())
  isActive Boolean     @default(false)
  type     TypePayment

  veterinary   Veterinary? @relation(fields: [veterinaryId], references: [id])
  veterinaryId String?
}

model Appointment {
  id        String      @id @default(uuid())
  pets      Pet[]
  service   TypeService
  startTime DateTime
  endTime   DateTime
  status    Status
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  owner        OwnerProfile @relation(fields: [ownerId], references: [id])
  ownerId      String
  vet          VetProfile   @relation(fields: [vetId], references: [id])
  vetId        String
  veterinary   Veterinary   @relation(fields: [veterinaryId], references: [id])
  veterinaryId String
}

enum Status {
  PENDING
  COMPLETED
  CANCELLED
}

enum Role {
  USER
  ADMIN
  VET
  OWNER
}

enum Specialty {
  SURGERY
  DERMATOLOGY
  CARDIOLOGY
  ONCOLOGY
  NEUROLOGY
}

enum TypeService {
  CONSULTATION
  SURGERY
  GROOMING
  EMERGENCY
}

enum TypePayment {
  MERCADOPAGO
  VISA
  MASTERCARD
  PREX
  CASH
}
